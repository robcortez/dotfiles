#!/usr/bin/python
#from __future__ import print_function
import os, sys
import argparse
from mutagen.mp3 import MP3
from mutagen.id3 import ID3NoHeaderError
from mutagen.id3 import ID3, TIT2, TALB, TPE1, TPE2, COMM, USLT, TCOM, TCON, TDRC, TRCK

parser = argparse.ArgumentParser(description='PyTag')
parser.add_argument('directory', help='directory to fix tags', action='store')

args = parser.parse_args()

for root, dirs, files in os.walk(args.directory):
    for f in files:
        if f.endswith(".mp3"):
            file = os.path.join(root, f)
            notags = False
            try:
                audio = ID3(file)
            except ID3NoHeaderError:
                print "No ID3 Header"
                notags = True
                audio = ID3()
            title = audio["TIT2"]
            artist = audio["TPE1"]
            album = audio["TALB"]
            year = audio["TDRC"]
            track = audio["TRCK"]
            
            audio["TRCK"] = TRCK(encoding=3, text=unicode(str(track).zfill(2)))
            #audio.save(file)
            print str(track) + ' - ' + artist[0] + ' - ' + title[0]
